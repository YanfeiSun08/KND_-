O9100 (端面测量) ;
(判断程序调用方法) ;
IF [ ! ISNULL[#16] ] GOTO 10 ( G65调用 ) ;
PARAMS[r1,r2,r3,r7,r11 ] (与主程序CALL配对使用) ;
N10 (判断程序调用结束) ;
(子程序局部变量赋值与程序使用变量) ;
#201 = #1  (量仪与砂轮间距) ;
#202 = #2  (开启端面测量误差检查) ;
#203 = #3  (误差范围设定) ;
#207 = #7  (端面量仪功能 0,不启用 1,启用) ;
#211 = #11 (模式选择 1,工件磨削,2砂轮休整,3端面量仪) ;
(变量赋值结束) ;
IF [ #207 != 1 ] GOTO 2000 (不使用端面量仪结束程序);
IF [ #211 != 1  || #211 != 3 ] GOTO 2000 (不进行端面测量结束程序) ;
(开启端面测量误差检查) ;
IF [ #202 == 0 ] THEN #910 = 0 (不开启端面误差检查，端面误差检查计数清零);
IF [ #202 == 1 ] THEN #910 = #910 + 1 (开启端面误差检查，端面误差检查计数);
(端面测量开始) ;
G59 (端面量仪坐标系) ;
M51 (端面量仪退回) ;
G00 Z-10 (端面量仪Z定位) ;
G00 X0 (端面量仪X定位) ;
M50 (端面量仪伸出) ;
Z0 ;
(量仪测量)
G31 G01 W10.0 F40 P5 ;
( G31 G01 W6.0 F20 P6 ) 
(端面量仪信号检测) ;
IF [ #910 == 1 ] THEN #911 = #5012 (初次开启端面误差检查，记录Z轴机床坐标基准值) ;
#912 = #5012 (记录当次Z轴机床坐标);
G04 X0.5 ;
#913 = 0.0 (当次误差值);
IF [ #910 >= 1 ] THEN #913 = FABS [ #5012 - #911 * 1.0 ] ;
G00 Z-10 ;
M51 ;
IF [ #913 > #203 ] THEN ERR [ 1 , " 端面测量误差值过大 " ] ;
G10 P1 L1 Z [#912+] (G54工件坐标系Z轴补偿);
(端面测量结束) ;
N2000 (程序结束顺序号) ;
M51 ;
M99 ;